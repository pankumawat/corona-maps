<!DOCTYPE html>
<html>
  <head>
  <title>My map</title>
        <link rel='stylesheet' type='text/css' href='https://api.tomtom.com/maps-sdk-for-web/cdn/5.x/5.37.2/maps/maps.css'/>
        <script src='https://api.tomtom.com/maps-sdk-for-web/cdn/5.x/5.37.2/maps/maps-web.min.js'></script>
        <style>
            #map {
              height: 1000px;
              width: 1000px;
          }
        </style>
    </head>
    <body>
        <div id='map'></div>
        <script>

            const params = new URLSearchParams(window.location.search)
            manager = params.has("mgr") ? params.get("mgr") : "nikhil";
            fetch(`/details/${manager}`).then(
                response => response.json()).then(json => {
                    json = json.data;
                    console.dir(json);
                    var map = tt.map({
                        container: 'map',
                        key: 'cIAeadsUq9FLomONz35wTAbx6NwfcsWY',
                        center: [json.geoCenter.lng, json.geoCenter.lat],
                        zoom: 10
                    });

                    json.people.forEach(emp => {
                        const person = document.createElement("DIV");
                        const pic = document.createElement("IMG");
                        pic.setAttribute("src", emp.profile);
                        pic.setAttribute("width", "50");
                        pic.setAttribute("height", "58");
                        pic.setAttribute("alt", "The Pulpit Rock");


                        person.appendChild(pic)
                        const name = document.createElement("LABEL");
                        name.innerHTML=`<br>${emp.name} (${emp.risk})`;

                        person.appendChild(name)

                        new tt.Marker({
                            element: person
                        })
                            .setLngLat([emp.geo.lng,emp.geo.lat])
                            .addTo(map);
                    })
                }
            )
            // const json = JSON.parse('{"people":[{"name":"Junaid Karim","isManager":true,"address":{"state":"Delhi","dist":"South Delhi"},"geo":{"lat":"28.48209","lng":"77.188555"},"active":70,"confirmed":70,"deceased":0,"recovered":0,"risk":2,"profile":"http://localhost:3001/images/pp/junaid.png"},{"name":"Pankaj Kumawat","address":{"state":"Uttar Pradesh","dist":"Gautam Buddha Nagar"},"isManager":false,"geo":{"lat":"28.35898255","lng":"77.550762"},"active":1699,"confirmed":12010,"deceased":50,"recovered":10261,"risk":5,"profile":"http://localhost:3001/images/pp/pankaj.png"},{"name":"Mustufa Gunderwala","address":{"state":"Uttar Pradesh","dist":"Gautam Buddha Nagar"},"isManager":false,"geo":{"lat":"28.35898255","lng":"77.550762"},"active":1699,"confirmed":12010,"deceased":50,"recovered":10261,"risk":5,"profile":"http://localhost:3001/images/pp/mustufa.png"}],"geoCenter":{"lat":28.400018366666668,"lng":77.43002633333333}}');

        </script>
    </body>
</html>